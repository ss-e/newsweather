<html>
<head>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<!--
  /*:root {
    --mawe: 575.6px;
    --mw: 250px;
    --mwb: 680px;
  }*/

@keyframes marquee {
  0%   { transform: translate(0, 0); }
  100% { transform: translate(-100%, 0); }
}
@keyframes wmarq {
  0%   { transform: translateX(0); }
  20% { transform: translateX(0); }
  70% { transform: translateX(calc(-100% + 575px)); }
  100% { transform: translateX(calc(-100% + 575px)); }
  /*70% { transform: translateX(calc(-100% + var(--mawe))); }
  100% { transform: translateX(calc(-100% + var(--mawe))); }*/
  /*80% { transform: translateX(calc(-100% + 500px)); }
  100% { transform: translateX(calc(-100% + 500px)); }*/
}
@keyframes slide {
  0% { transform: translateY(0); }
  10% { transform: translateY(0); }
  80% { transform: translateY(calc(-100% + 250px)); }
  100% { transform: translateY(calc(-100% + 250px)); }
  /*
  80% { transform: translateY(calc(-100% + var(--mw))); }
  100% { transform: translateY(calc(-100% + var(--mw))); }
  */
}
@keyframes bigslide {
  0% { transform: translateY(0); }
  10% { transform: translateY(0); }
  80% { transform: translateY(calc(-100% + 680px)); }
  100% { transform: translateY(calc(-100% + 680px)); }
  /*
  80% { transform: translateY(calc(-100% + var(--mwb))); }
  100% { transform: translateY(calc(-100% + var(--mwb))); }
  */
}
-->
<style>
@keyframes marquee {
  0%   { transform: translate3d(0, 0, 0); }
  100% { transform: translate3d(-100%, 0, 0); }
}
.body {
  padding:0;
  border-width:0;
}
.date {
  height: 5%;
  width: 20%;
  left: 70%;
  top: 0;
  position: absolute;
  background: #EEEEEE;
  font-size: 3vw;
  text-align: center;
  font: 'Bitstream Vera';
  font-weight: bold;
  display: flex;
  justify-content: center;
  align-items: center;
}
.time {
  height: 5%;
  width: 20%;
  left: 70%;
  top: 5%;
  position: absolute;
  background: #EEEEEE;
  font-size: 2vw;
  text-align: center;
  font: 'Bitstream Vera';
  font-weight: bold;
  display: flex;
  justify-content: center;
  align-items: center;
}
.logo {
  height: 10%;
  width: 10%;
  left: 90%;
  top: 0;
  position: absolute;
  background: #111111;
  font-size: 4vw;
  text-align: center;
  font: 'Bitstream Vera';
  font-weight: bold;
  color: white;
  display: flex;
  justify-content: center;
  align-items: center;
}
.stock {
  height: 10%;
  width: 30%;
  left: 70%;
  top: 10%;
  position: absolute;
  background: #111111;
  font-size: 3vw;
  text-align: center;
  font: 'Bitstream Vera';
  font-weight: bold;
  color: white;
  display: flex;
  justify-content: center;
  align-items: center;
}
.stock p {
  font-size: 2vw;
}
.sports {
  height: 30%;
  width: 30%;
  left: 70%;
  top: 20%;
  position: absolute;
  background: #EEEEEE;
  font-size: 4vw;
  text-align: center;
  font: 'Bitstream Vera';
  font-weight: bold;
  color: black;
  display: flex;
  justify-content: center;
  align-items: center;
}
.weather {
  height: 40%;
  width: 30%;
  left: 70%;
  bottom: 10%;
  position: absolute;
  background: #111111;
  font: 'Bitstream Vera';
  font-weight: bold;
  color:white;
  display: block;
  overflow:hidden;
}
.wheader {
  /*width: 100%;*/
  /*left: 0px;*/
  font-size: 4vw;
  text-align: center;
  /*padding-left: 100%;*/
  white-space: nowrap;
  display: inline-block;
  animation: wmarq 15s linear 1;
  overflow:visible;
  min-width: 575px
}
/*
.wheader p {
  display: inline-block;
  animation: wmarq 15s linear 1;
}*/
.wcontainer{
  display: flex;
}
.weathernow {
  font-size: 3vw;
  text-align: center;
}
.wchild {
  font-size: 3vw;
  text-align: center;
  width: 33%;
}
.wpopup {
  font-size: 1vw;
  /*text-align: center;*/
  width:75px;
  /*background: #111111;*/
  font: 'Bitstream Vera';
  font-weight: bold;
  color: #111111;
  white-space: nowrap;
  text-shadow:
    -1px -1px 0 white,
    1px -1px 0 white,
    -1px 1px 0 white,
    1px 1px 0 white;
}
.inet {
  height: 30%;
  width: 30%;
  left: 70%;
  bottom: 50%;
  position: absolute;
  background: #EEEEEE;
  color: #000000;
  font-size: 3vw;
  text-align: center;
  font: 'Bitstream Vera';
  font-weight: bold;
  justify-content: center;
  align-items: center;
  word-break: break-all;
}
.inettitle {
  font-size: 3vw;
  vertical-align: top;
}
.inetstatus {
  font-size: 25px;
  position: relative;
  /*position: absolute;*/
  /*height: var(--mw);*/
  height: 250px;
  left: 0px;
  /*top: 3vw;*/
  bottom: 0;
  width: 100%;
  text-align: center;
  font: 'Bitstream Vera';
  font-weight: bold;
  justify-content: center;
  align-items: center;
  overflow: hidden;
  margin-top: 0px;
  margin-bottom: 0px;
}
.inetstatus p {
  /*display: inline-block;*/
  position: absolute;
  animation: slide 30s linear 1;
  width: 100%;
  /*padding-bottom: 100%;*/
  margin-top: 0px;
  margin-bottom: 0px;
  vertical-align: bottom;
  text-align: center;
  line-height:1.2em;
  /*min-height: var(--mw);*/
  min-height: 250px;
}
.main {
  height: 90%;
  width: 70%;
  left: 0;
  top: 0;
  position: absolute;
  background: #111111;
  /*background: darkblue;
  font-size: 4vw;
  text-align: center;
  font: 'Bitstream Vera';
  font-weight: bold;
  color: white;
  display: flex;
  justify-content: center;
  align-items: center;*/
}
.ticker {
  height: 10%;
  width: 100%;
  left: 0px;
  bottom: 0;
  position: absolute;
  background: #EEEEEE;
  font-size: 3vw;
  text-align: right;
  font: 'Bitstream Vera';
  font-weight: bold;
  white-space: nowrap;
  overflow: hidden;
  /*box-sizing: border-box;*/
}
.ticker p {
  will-change: transform;
  display: inline-block;
  padding-left: 100%;
  animation: marquee 300s linear 1;
  margin-top: 0px;
  margin-bottom: 0px;
}
.bumper {
  background: #111111;
  font-size: 6vw;
  font: 'Bitstream Vera';
  font-weight: bold;
  color: white;
  position: relative;
  height: 100%;
  width: 100%;
  justify-content: center;
  align-items: center;
  text-align: center;
}
.textmain {
  background: #111111;
  font: 'Bitstream Vera';
  color: white;
  display: flex;
  height: 100%;
  width: 100%;
  overflow: hidden;
  /*animation: slide 20s linear 1;*/
}
.tmheader {
  font-size: 3vw;
  text-align: center;
  font-weight: bold;
  color: white;
  display: flex;
  /*height: 100%;*/
  width: 100%;
  overflow: hidden;
  justify-content: center;
  /*animation: slide 20s linear 1;*/
}
.tmtext {
  background: #111111;
  font-size: 2vw;
  color: white;
  display: flex;
  height: 80%;
  width: 100%;
  overflow: hidden;
  /*margin-left: 250px;
  animation: bigslide 20s linear 1;*/
}
.wmap{
  background: #111111;
  font-size: 6vw;
  text-align: center;
  font: 'Bitstream Vera';
  font-weight: bold;
  color: white;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100%;
  width: 100%;
}

</style>
<script>
var weatheri = 0;
//var mainscreen = ["bmain","bweather","bstock","binet"]
//var mainscreen = ["bmain","bweather","wnanortheast","wnawest","wnasouth","wsacentral","wsasouth","weuwest","weunorth","weueast","wafnorth","wafeast", "wafsouth", "wmecenter","wasiacenter","wasiasouth","bstock","ss0","ss1","ss2","ss3","sc","bnews","nh0","nh1","nh2","nh3","nh4","nh5","nh6","nh7","nh8","nh9","nh10","binet","is0","is1","is2","is3","is4"]
var mainscreen = ["bmain","bweather","wnanortheast","wnawest","wnasouth","wsacentral","wsasouth","weuwest","weunorth","weueast","wafnorth","wafeast", "wafsouth", "wmecenter","wasiacenter","wasiasouth","bstock","ss0","ss1","ss2","ss3","sc0","sc1","binet","ia"]
//var mainscreen = ["bstock","ss0","ss1","ss2","ss3","ss4","ss5","sc","sx","bnews","nh0","nh1","nh2","nh3","nh4","nh5","nh6","nh7","nh8","nh9","nh10","binet","is0","is1","is2","is3","is4"]
//var mainscreen = ["bstock","ss0","ss1","ss2","ss3","sc0","bnews","nh0","nh1","nh2","nh3","nh4","nh5","nh6","nh7","nh8","nh9","nh10","binet","is0","is1","is2","is3","is4"]
//var mainscreen = ["bstock","sc0","sc1","ss0","ss1","ss2","ss3","binet", "ia"]
//var mainscreen = ["binet", "ia"]
var stocki = 0;
var stockj = "";
var charti = 0;
var finStock, finCrypto
//var finFxSym = [{name:"USDEUR", value:""}, {name:"USDJPY", value:""}, {name:"USDGBP", value:""}, {name:"USDAUD", value:""}, {name:"USDCAD", value:""}, {name:"USDCNY", value:""}]
var inetSym
var ineti = 0
var headlines = []
var audioNum = 0
var weatherdb = []
//helper functions
function shuffleArray(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
	return array
}
function next(arr) {
  arr.push(arr[0]);
  return arr.shift();
}
function emojiParse(weather){
  //console.log("weather: " + weather)
  wtemp = weather.toString()
  //console.log("wtemp: " + wtemp)
  switch (wtemp.charAt(0)) {
    case "2":
    //thunderstorm
    return "\uD83C\uDF29\uFE0F"
    case "3":
    //drizzle
    return "\uD83C\uDF26\uFE0F"
    case "5":
    //rain
    return "\uD83C\uDF27\uFE0F"
    case "6":
    //snow
    return "\u2744\uFE0F"
    case "7":
    //atmosphere
    return "\uD83C\uDF2B\uFE0F"
    case "8":
      //clear
      if (wtemp.charAt(2) == 0) {
        return "\uD83C\uDF1E"
      }
      //partly cloudy
      else if (wtemp.charAt(2) == "1" || wtemp.charAt(2) == "2") {
        return "\uD83C\uDF24\uFE0F"
      }
      //clouds
      else if (wtemp.charAt(2) == "3" || wtemp.charAt(2) == "4") {
        return "\u2601\uFE0F"
      }
    default:
    return ("error: " + wtemp.charAt(0))
  }
  return ("big error: " + wtemp)
}
/* weather info */
function getWeatherData () {
  readWeatherDB().then((temp) => {
    //console.log(JSON.stringify(temp))
    //console.log("item 0 now temp: ",temp[0].Now[0], " id:", temp[0].Now[1])
    weatherdb = temp
    nextWeatherTab()
  })
}

function nextWeatherTab() {
  //getWeatherData()
  if (weatheri == weatherdb.length) {
    weatheri = 0
  }
  //var s = document.getElementById('weather')
  var r = document.getElementById('weather')
  r.innerHTML = ""
  var t = document.createElement('div')
  var n = document.createElement('div')
  n.setAttribute('class', "weathernow")
  var wc = document.createElement('div')
  var w1 = document.createElement('div')
  var w2 = document.createElement('div')
  var w3 = document.createElement('div')
  t.setAttribute('class', "wheader")
  wc.setAttribute('class', "wcontainer")
  w1.setAttribute('class', "wchild")
  w2.setAttribute('class', "wchild")
  w3.setAttribute('class', "wchild")
  t.innerHTML = weatherdb[weatheri].Name
  n.innerHTML = emojiParse(weatherdb[weatheri].Now[1]) + " " + Math.round(weatherdb[weatheri].Now[0]).toString() + String.fromCharCode(176) + "c"
  var now = new Date()
  //console.log("tz: ", weatherdb[weatheri].Tz)
  var now2 = new Date(now.toLocaleString('en-us', {timeZone:weatherdb[weatheri].Tz}))
  //now.setHours(now.getUTCHours() + parseInt(weatherdb[weatheri].tz));
  //var hour = now2.getUTCHours()
  var hour = now2.getHours()
  //console.log("current hour is: " + hour)
  if (hour < 6) { //overnight
    w1.innerHTML = "MOR<br />" + Math.round(weatherdb[weatheri].W1[0]).toString() + String.fromCharCode(176) + "c<br />" + emojiParse(weatherdb[weatheri].W1[1])
    //w1.innerHTML = "MOR<br />" + weatherdb[weatheri].w1.temp + String.fromCharCode(176) + "c<br />" + emojiParse(weatherdb[weatheri].w1.id)
    w2.innerHTML = "AFT<br />" + Math.round(weatherdb[weatheri].W2[0]).toString() + String.fromCharCode(176) + "c<br />" + emojiParse(weatherdb[weatheri].W2[1])
    w3.innerHTML = "EVE<br />" + Math.round(weatherdb[weatheri].W3[0]).toString() + String.fromCharCode(176) + "c<br />" + emojiParse(weatherdb[weatheri].W3[1])
  } else if (hour >= 6 && hour < 12) { //morning
    w1.innerHTML = "AFT<br />" + Math.round(weatherdb[weatheri].W1[0]).toString() + String.fromCharCode(176) + "c<br />" + emojiParse(weatherdb[weatheri].W1[1])
    //w1.innerHTML = "AFT<br />" + weatherdb[weatheri].w1.temp + String.fromCharCode(176) + "c<br />" + emojiParse(weatherdb[weatheri].w1.id)
    w2.innerHTML = "EVE<br />" + Math.round(weatherdb[weatheri].W2[0]).toString() + String.fromCharCode(176) + "c<br />" + emojiParse(weatherdb[weatheri].W2[1])
    w3.innerHTML = "OVR<br />" + Math.round(weatherdb[weatheri].W3[0]).toString() + String.fromCharCode(176) + "c<br />" + emojiParse(weatherdb[weatheri].W3[1])
  } else if (hour >= 12 && hour < 18) { //afternoon
    w1.innerHTML = "EVE<br />" + Math.round(weatherdb[weatheri].W1[0]).toString() + String.fromCharCode(176) + "c<br />" + emojiParse(weatherdb[weatheri].W1[1])
    //w1.innerHTML = "EVE<br />" + weatherdb[weatheri].w1.temp + String.fromCharCode(176) + "c<br />" + emojiParse(weatherdb[weatheri].w1.id)
    w2.innerHTML = "OVR<br />" + Math.round(weatherdb[weatheri].W2[0]).toString() + String.fromCharCode(176) + "c<br />" + emojiParse(weatherdb[weatheri].W2[1])
    w3.innerHTML = "MOR<br />" + Math.round(weatherdb[weatheri].W3[0]).toString() + String.fromCharCode(176) + "c<br />" + emojiParse(weatherdb[weatheri].W3[1])
  } else if (hour >= 18) { //evening
    w1.innerHTML = "OVR<br />" + Math.round(weatherdb[weatheri].W1[0]).toString() + String.fromCharCode(176) + "c<br />" + emojiParse(weatherdb[weatheri].W1[1])
    //w1.innerHTML = "OVR<br />" + weatherdb[weatheri].w1.temp + String.fromCharCode(176) + "c<br />" + emojiParse(weatherdb[weatheri].w1.id)
    w2.innerHTML = "MOR<br />" + Math.round(weatherdb[weatheri].W2[0]).toString() + String.fromCharCode(176) + "c<br />" + emojiParse(weatherdb[weatheri].W2[1])
    w3.innerHTML = "AFT<br />" + Math.round(weatherdb[weatheri].W3[0]).toString() + String.fromCharCode(176) + "c<br />" + emojiParse(weatherdb[weatheri].W3[1])
  } else {
    //error
    w1.innerHTML = hour
  }
  wc.appendChild(w1)
  wc.appendChild(w2)
  wc.appendChild(w3)
  r.appendChild(t)
  r.appendChild(n)
  r.appendChild(wc)
  weatheri++
  //next(weatherdb)
}

/* stock ticker */
/*
function getCurrencyData() {
  var req = new XMLHttpRequest();
  var fxString = []
  for (x in finFxSym) {
    fxString.push(finFxSym[x].name)
  }
  var url = iexsite + "stable/fx/latest?symbols=" + fxString.join(",") + "&token=" + iexapikey
  req.onload = function(e) {
    var temp = JSON.parse(this.responseText)
    for (x in temp) {
     for (y in finFxSym) {
        if (finFxSym[y].name == temp[x].symbol) {
          finFxSym[y].value = temp[x].rate;
          break;
        }
      }
    }
  }
  req.open("GET", url);
  req.responseType = "text";
  req.send();
}
}*/
function getFinanceData() {
  console.log("getting finance data")
  readStockDB().then((temp) => {
    //console.log("STOCKDB: " + JSON.stringify(temp))
    //console.log("item 0 now temp: ",temp[0].Now[0], " id:", temp[0].Now[1])
    finStock = temp
  })
  readCryptoDB().then((temp) => {
    //console.log("CRYPTODB: " + JSON.stringify(temp))
    //console.log("item 0 now temp: ",temp[0].Now[0], " id:", temp[0].Now[1])
    finCrypto = temp
  })
}
function nextFinanceTab() {
  var s = document.getElementById('stock')
  /*
  if (stockj == "Crypto") {
      if (stocki == finCrypto.length) {
        s.textContent = "Currency"
        stockj = "Currency"
        stocki = 0
    } else {
        s.textContent = finCrypto[0].name + ": " + finCrypto[0].value
        stocki++
    }
  } else if (stockj == "Currency") {
    if (stocki == finFxSym.length) {
        s.textContent = "Stock"
        stockj = "Stock"
        stocki = 0
    } else {
      var temp = parseFloat(finFxSym[0].value)
      s.textContent = finFxSym[0].name + ": " + temp.toFixed(4)
      stocki++
    }
  } else if (stockj == "" || stockj == "Stock") {
    if (stocki == finStock.length) {
        s.textContent = "Crypto"
        stockj = "Crypto"
        stocki = 0
    } else {
      var temp = parseFloat(finStock[0].value).toFixed(2)
      var changepercent = parseFloat(finStock[0].changePercent).toFixed(2);
      if (changepercent > 0) {
        var temp2 = "<p style='color:green'>\u2191</p>" + changepercent + "%"
      } else if (changepercent < 0) {
        var temp2 = "<p style='color:red'>\u2193</p>" + changepercent + "%"
      } else if (changepercent == 0) {
        var temp2 = "\u8211" + changepercent + "%"
      } else {
        var temp2 = "err"
      }
      s.innerHTML = "<p>" + finStock[0].name + ": " + temp + temp2 + "</p>"
      stocki++
    }
  }
  */
  if (stockj == "Crypto") {
      if (stocki == finCrypto.length) {
        s.textContent = "Stock"
        stockj = "Stock"
        stocki = 0
    } else {
        var changepercent = parseFloat(parseFloat(finCrypto[stocki].ChangePercent).toFixed(2));
        if (changepercent > 0) {
          //var temp2 = "<p style='color:green;font-size:200%;'> \u2191</p>" + changepercent + "%"
          var temp2 = "<p style='color:green;font-size:100%;'>\u25B2</p>" + changepercent + "%"
        } else if (changepercent < 0) {
          //var temp2 = "<p style='color:red;font-size:200%;'> \u2193</p>" + changepercent + "%"
          var temp2 = "<p style='color:red;font-size:100%;'> \u25BC</p>" + changepercent + "%"
        } else if (changepercent == 0) {
          var temp2 = /*"\u8211"*/ "<p style='font-size:100%;> = </p>" + changepercent + "%"
        } else {
          var temp2 = "err"
        }
        s.innerHTML = "<p>" + finCrypto[stocki].Name + ": " + finCrypto[stocki].Value + temp2 + "</p>"
        stocki++
    }
  } else if (stockj == "" || stockj == "Stock") {
    if (stocki == finStock.length) {
        s.textContent = "Crypto"
        stockj = "Crypto"
        stocki = 0
    } else {
      var temp = parseFloat(finStock[stocki].Value).toFixed(2)
      var changepercent = parseFloat(parseFloat(finStock[stocki].ChangePercent).toFixed(2));
      if (changepercent > 0) {
        //var temp2 = "<p style='color:green;font-size:200%;'>\u2191</p>" + changepercent + "%"
        var temp2 = "<p style='color:green;font-size:100%;'>\u25B2</p>" + changepercent + "%"
      } else if (changepercent < 0) {
        //var temp2 = "<p style='color:red;font-size:200%;'>\u2193</p>" + changepercent + "%"
        var temp2 = "<p style='color:red;font-size:100%;'>\u25BC</p>" + changepercent + "%"
      } else if (changepercent == 0) {
        var temp2 = /*"\u8211"*/ "<p style='font-size:100%;> = </p>" + changepercent + "%"
      } else {
        var temp2 = "err"
      }
      s.innerHTML = "<p>" + finStock[stocki].Name + " " + temp + temp2 + "</p>"
      stocki++
    }
  }
}
/* news headline ticker */
function getNewsHeadlines () {
  try {
    readHeadlineDB().then((temp) => {
      document.getElementById('ticker').innerHTML = "";
      var m = document.createElement("p");
      //var m = document.createElement("marquee");
      m.id = "tickerchild"
      m.textContent = temp.join(" \u2022 ")
      m.addEventListener('animationend', () => {
        getNewsHeadlines()
      });
      //m.onbounce = getNewsHeadlines()
      document.getElementById('ticker').appendChild(m)
    })
  }
  catch {
    console.log("Error reading news db! Called from getNewsHeadlines")
  }
}

/* internet site uptime */
function getInetData () {
  try {
    readInetDB().then((temp) => {
      //console.log(JSON.stringify(temp))
      //console.log("item 0 now temp: ",temp[0].Now[0], " id:", temp[0].Now[1])
      inetSym = temp
      //nextWeatherTab()
    })
  }
  catch {
    console.log("Error reading inet db! Called from getInetData")
  }
}
function nextInetUptime() {
  try {
    console.log("inetsym len:",inetSym.length)
    if (ineti == inetSym.length) {
      ineti = 0
    }
  } catch(err) {
    console.log("error finding length!")
  }
  var s = document.getElementById('inet')
  try {
    var list = inetSym[ineti].Status
  } catch(err) {
    console.log("error defining inetSym status!")
  }
  /*
  try {
    console.log("inet name ", inetSym[ineti].Name ," status:", inetSym[ineti].Status)
  }
  catch(err) {
    console.log("error outputting name/status:", err)
  }*/
  var result = ""
  try {
    //console.log("list length: ", list.length)
    if (list.length > 0) {
      list.forEach(function(currentValue, currentIndex, listObj) {
        result += "\u2022 " + currentValue + " <br />"
      })
    } else {
      result = "OK"
    }
  } catch (e) {
      if (e instanceof ReferenceError) {
        result = "OK"
        console.log("unable to parse list entries")
      }
  }
  try {
    s.innerHTML = "<div class='inettitle' id='inettitle'>" + inetSym[ineti].Name + "</div><div class='inetstatus' id='inetstatus'><p>" + result + "</p></div>"
  } catch (e) {
    console.log("unable to output entry")
  }
  ineti++
}
/* date */
/* update weather map*/
function updateMap() {
  mapsPlaceholder[0].eachLayer(function (layer) {
    //console.log(layer._url)
    if (!layer._url) {
      mapsPlaceholder[0].removeLayer(layer)
    }
  });
  for (x in weatherdb) {
    updateMapData(weatherdb[x].Lat,weatherdb[x].Lon,weatherdb[x].Name,weatherdb[x].Now[1],weatherdb[x].Now[0])
  }
}
function updateMapData(lat, lon, name, id, temp) {
  var newIcon = L.divIcon({className:"wpopup", iconAnchor:[37.5,37.5], iconSize:"0px", html: '<p>' + name + "<br />" + emojiParse(id) + " " + Math.round(temp).toString() + String.fromCharCode(176) + "c</p>"})
  L.marker([lat,lon],{icon: newIcon}).addTo(mapsPlaceholder[0])
  //mapsPlaceholder[0].setView([39.09973, -94.57857], 4)
}
function datetime() {
  var timer = document.getElementById('time');
  var date = document.getElementById('date');
  var d = new Date();
  var s = ('0' + d.getUTCSeconds()).slice(-2);
  var m = ('0' + d.getUTCMinutes()).slice(-2);
  var h = ('0' + d.getUTCHours()).slice(-2);
  timer.textContent = h + ":" + m + ":" + s + " UTC";
  date.textContent = d.toUTCString().slice(0,11);
}
/* views */
function nextMainView() {
  document.getElementById("tmheader").innerHTML = ""
  document.getElementById("tmtext").innerHTML = ""
  //delete chart
  try {
    document.querySelector("#tmtext").destroy();
  } catch (err) {
    if (err instanceof TypeError) {
    } else {
    console.log("attempt to destroy chart failed with: ", err)
    }
  }
  //console.log("from:", mainscreen, "displaying: ", mainscreen[0])
  console.log("displaying: ", mainscreen[0])
  switch (mainscreen[0].charAt(0)) {
    case 'b':
      document.getElementById("bumper").style.display = "flex"
      document.getElementById("wmap").style.display = "none"
      document.getElementById("textmain").style.display = "none"
      if (mainscreen[0].substr(1) == "main") {
        document.getElementById("bumper").innerHTML = "International News and Weather"
      } else if (mainscreen[0].substr(1) == "weather") {
        document.getElementById("bumper").innerHTML = "Current International Weather"
      } else if (mainscreen[0].substr(1) == "stock") {
        document.getElementById("bumper").innerHTML = "Financial Market Report"
      } else if (mainscreen[0].substr(1) == "news") {
        document.getElementById("bumper").innerHTML = "International News Headlines"
      } else if (mainscreen[0].substr(1) == "inet") {
        document.getElementById("bumper").innerHTML = "Internet Service Status"
      } else {
        document.getElementById("bumper").innerHTML = mainscreen[0].substr(1)
      }
      setTimeout("nextMainView()", 20000);
      break;
    case 'w':
      document.getElementById("bumper").style.display = "none"
      document.getElementById("wmap").style.display = "block"
      document.getElementById("textmain").style.display = "none"
      if (mainscreen[0].substr(1) == "nanortheast") {
        mapsPlaceholder[0].setView([40.71427, -78.00597], 5.5)
      } else if (mainscreen[0].substr(1) == "nawest") {
        mapsPlaceholder[0].setView([43.2827, -121.1207], 5.25)
      } else if (mainscreen[0].substr(1) == "nasouth") {
        mapsPlaceholder[0].setView([23.76328, -95.36327], 5.49)
      } else if (mainscreen[0].substr(1) == "sacentral") {
        mapsPlaceholder[0].setView([13.603278, -79.142208], 5.49)
      } else if (mainscreen[0].substr(1) == "sasouth") {
        mapsPlaceholder[0].setView([-19.735657, -56.530847], 5.49)
      } else if (mainscreen[0].substr(1) == "euwest") {
        mapsPlaceholder[0].setView([47.532038, -3.511075], 5.49)
      } else if (mainscreen[0].substr(1) == "eunorth") {
        mapsPlaceholder[0].setView([62.237233, 0], 5.49)
      } else if (mainscreen[0].substr(1) == "eueast") {
        mapsPlaceholder[0].setView([53.501117, 34.204930], 5.49)
      } else if (mainscreen[0].substr(1) == "afnorth") {
        mapsPlaceholder[0].setView([27.780772, 14.240158], 5.49)
      } else if (mainscreen[0].substr(1) == "afeast") {
        mapsPlaceholder[0].setView([1.428075, 35.776460], 5.49)
      } else if (mainscreen[0].substr(1) == "afsouth") {
        mapsPlaceholder[0].setView([-18.458768, 29.004463], 5.49)
      } else if (mainscreen[0].substr(1) == "mecenter") {
        mapsPlaceholder[0].setView([34.687428, 57.763462], 5.49)
      } else if (mainscreen[0].substr(1) == "asiacenter") {
        mapsPlaceholder[0].setView([33.596319, 122.932938], 5.49)
      } else if (mainscreen[0].substr(1) == "asiasouth") {
        mapsPlaceholder[0].setView([-9.579084, 125.735125], 4)
      }
      setTimeout("nextMainView()", 20000);
      break;
    case 'n':
      document.getElementById("bumper").style.display = "none"
      document.getElementById("wmap").style.display = "none"
      document.getElementById("textmain").style.display = "block"
      if (mainscreen[0].substr(1).charAt(0) == "h") {
        var hln = parseInt(mainscreen[0].substr(2))
        console.log("checking headline #" + hln)
        document.getElementById("tmheader").innerHTML = headlines[hln]
        document.getElementById("tmtext").innerHTML = "A summary for the article will appear here in the future"
        //document.getElementById("textmain").style += "animation: slide 20s linear 1;"
      }
      setTimeout("nextMainView()", 20000);
      break;
    case 'i':
      document.getElementById("bumper").style.display = "none"
      document.getElementById("wmap").style.display = "none"
      document.getElementById("textmain").style.display = "block"
      if (mainscreen[0].substr(1).charAt(0) == "s") {
        var hln = parseInt(mainscreen[0].substr(2))
        console.log("checking status #" + hln)
        document.getElementById("tmheader").innerHTML = inetSym[hln].name
        document.getElementById("tmtext").innerHTML = inetSym[hln].status
        //document.getElementById("textmain").style += "animation: slide 20s linear 1;"
      } else if (mainscreen[0].substr(1).charAt(0) == "a") {
        console.log("checking inetstatus")
        document.getElementById("tmheader").innerHTML = "Internet Service Status"
        document.getElementById("tmtext").innerHTML += "<br /><br />";
        for (x in inetSym) {
          var temp = inetSym[x].Status
          if (inetSym[x].Status === null || inetSym[x].Status == "") {
            temp = "OK"
          } else {
            temp = inetSym[x].Status
          }
          document.getElementById("tmtext").innerHTML += inetSym[x].Name + " : " + temp + "<br /><br />"
        }
        //document.getElementById("textmain").style += ""
      }
      setTimeout("nextMainView()", 20000);
      break;
    case 's':
      document.getElementById("bumper").style.display = "none"
      document.getElementById("wmap").style.display = "none"
      document.getElementById("textmain").style.display = "block"
      if (mainscreen[0].substr(1) == "all") {
        document.getElementById("tmheader").innerHTML = "stonks"
      } else if (mainscreen[0].substr(1) == "x") {
        //fx
        document.getElementById("tmheader").innerHTML = "Currency Exchange"
        document.getElementById("tmtext").innerHTML += "<br /><br />";
        for (x in finFxSym) {
          document.getElementById("tmtext").innerHTML += finFxSym[x].name + ": " + finFxSym[x].value + "<br /><br />"
        }
      } else if (mainscreen[0].charAt(1) == "c") {
      /*else if (mainscreen[0].substr(1) == "c") {
        //crypto
        document.getElementById("tmheader").innerHTML = "Cryptocurrency"
        document.getElementById("tmtext").innerHTML += "<br /><br />";
        for (x in finCrypto) {
          document.getElementById("tmtext").innerHTML += finCrypto[x].name + ": " + finCrypto[x].value + "<br /><br />"
        }
      }*/
        //var temp = finCrypto.findIndex((obj => obj.name == host))
        var temp = parseInt(mainscreen[0].charAt(2))
        document.getElementById("tmheader").innerHTML = finCrypto[temp].Name
        console.log("looking up ", temp ," is:", finCrypto[temp].Name)
        var temp2 = parseFloat(parseFloat(finCrypto[temp].ChangePercent).toFixed(2))
        try {
          var temp3 = finCrypto[temp].Chartdata.length - 1
          var enddate = new Date(finCrypto[temp].Chartdata[temp3][0])
          if (temp2 > 0) {
            var color = "#008000"
            //var symbol = "\u2191"
            var symbol = "\u25B2"
          } else if (temp2 < 0) {
            var color = "#FF0000"
            //var symbol = "\u2193"
            var symbol = "\u25BC"
          } else {
            var color = "#808080"
            var symbol = /*"\u8211"*/ "="
          }
          console.log("color is ", color ," symbol is:", symbol)
          var options = {
            series: [{
              data: finCrypto[temp].Chartdata
            }],
            chart: {
              type: 'candlestick',
              toolbar: {
                show: false
              },
            },
            xaxis: {
              type: 'datetime',
              labels: {
                style: {
                  fontSize: '20px',
                  fontFamily: 'Bitstream Vera',
                  fontWeight: 'bold',
                  colors: ['#EEEEEE']
                }
              }
            },
            yaxis: {
              labels: {
                style: {
                  fontSize: '20px',
                  fontFamily: 'Bitstream Vera',
                  fontWeight: 'bold',
                  colors: ['#EEEEEE']
                }
              }
            },
            annotations: {
              xaxis: [{
                  x: enddate.getTime(),
                  borderColor: color,
                  label: {
                    borderColor: color,
                    textAnchor: 'end',
                    orientation: 'horizontal',
                    text: finCrypto[temp].Value + " " + symbol + temp2 + "%",
                    style: {
                      fontSize: '20px',
                      fontFamily: 'Bitstream Vera',
                      fontWeight: 'bold',
                      color: '#111111',
                      background: color,
                    }
                  }
              }]
            }
          }
          var chart = new ApexCharts(document.querySelector("#tmtext"), options);
          chart.render()
          console.log("rendering for", finCrypto[temp].Name ," chart:  ", finCrypto[temp].Chartdata)
        } catch (err) {
          if (err instanceof TypeError) {

          } else {
            console.log("when parsing chart: ", err)
          }
        }
      }
      else if (mainscreen[0].charAt(1) == "s") {
        //stock chart
        var temp = parseInt(mainscreen[0].charAt(2))
        document.getElementById("tmheader").innerHTML = finStock[temp].Name
        console.log("header at ", temp ," is:", finStock[temp].Name)
        var temp2 = parseFloat(parseFloat(finStock[temp].ChangePercent).toFixed(2))
        try {
          var temp3 = finStock[temp].Chartdata.length - 1
          var enddate = new Date(finStock[temp].Chartdata[temp3][0])
          if (temp2 > 0) {
            var color = "#008000"
            //var symbol = "\u2191"
            var symbol = "\u25B2"
          } else if (temp2 < 0) {
            var color = "#FF0000"
            //var symbol = "\u2193"
            var symbol = "\u25BC"
          } else {
            var color = "#808080"
            var symbol = /*"\u8211"*/ "="
          }
          console.log("color is ", color ," symbol is:", symbol)
          var options = {
            series: [{
              data: finStock[temp].Chartdata
            }],
            chart: {
              type: 'candlestick',
              toolbar: {
                show: false
              },
            },
            xaxis: {
              type: 'datetime',
              labels: {
                style: {
                  fontSize: '20px',
                  fontFamily: 'Bitstream Vera',
                  fontWeight: 'bold',
                  colors: ['#EEEEEE']
                }
              }
            },
            yaxis: {
              labels: {
                style: {
                  fontSize: '20px',
                  fontFamily: 'Bitstream Vera',
                  fontWeight: 'bold',
                  colors: ['#EEEEEE']
                }
              }
            },
            annotations: {
              xaxis: [{
                  x: enddate.getTime(),
                  borderColor: color,
                  label: {
                    borderColor: color,
                    textAnchor: 'end',
                    orientation: 'horizontal',
                    text: finStock[temp].Value + " " + symbol + temp2 + "%",
                    style: {
                      fontSize: '20px',
                      fontFamily: 'Bitstream Vera',
                      fontWeight: 'bold',
                      color: '#111111',
                      background: color,
                    }
                  }
              }]
            }
          }
          var chart = new ApexCharts(document.querySelector("#tmtext"), options);
          chart.render()
          console.log("rendering for: ", finStock[temp].Name ,"temp value:", temp, " name: ", finStock[temp].Chartdata)
        } catch (err) {
          console.log("when parsing chart: ", err)
        }
      }
      //stockdisplay(mainscreen.substr(1))
      setTimeout("nextMainView()", 20000);
      break;
    default:
      setTimeout("nextMainView()", 5000);
      break;
  }
  next(mainscreen)
}
/* init */
var mapsPlaceholder = [];
window.onload = init;
function init() {
  console.log("init")
  var element = document.getElementById('debug');
  L.Map.addInitHook(function () {
    mapsPlaceholder.push(this); // Use whatever global scope variable you like.
  });
  datetime();
  getWeatherData();
  getNewsHeadlines();
  getFinanceData();
  getInetData();
  nextMainView();
  setInterval("getInetData()", 30000);
  setInterval("getWeatherData()", 15000);
  setInterval("getFinanceData()", 30000);
  setInterval("nextInetUptime()", 30000);
  setInterval("nextFinanceTab()", 15000);
  //nextWeatherTab();
  //setInterval("nextWeatherTab()", 15000);
  setInterval("updateMap()", 30000);
  setInterval("datetime()", 1000);
  L.map('wmap', {attributionControl: false, zoomControl: false}).setView([0, -0], 0); //lat:"39.09973", lon:"-94.57857"
  L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/toner-background/{z}/{x}/{y}{r}.{ext}', {
    attribution: '',
    subdomains: 'abcd',
    minZoom: 0,
    maxZoom: 20,
    ext: 'png'
  }).addTo(mapsPlaceholder[0]);
  mapsPlaceholder[0].on('moveend', function() {
    //temp = mapsPlaceholder[0].invalidateSize
    setTimeout(function () {
      console.log("triggering map invalidatesize")
      mapsPlaceholder[0].invalidateSize()
      }, 1000)
  })
}
</script>
</head>
<body>
  <div class="wrapper" id="wrapper">
    <div class="wrapper" id="audiocontainer"></div>
    <div id="debug"></div>
    <div class="top" id="top"></div>
    <div class="logo" id="logo">INW</div>
    <div class="time" id="time"></div>
    <div class="date" id="date"></div>
    <div class="main" id="main">
      <div class="bumper" id="bumper"></div>
      <div class="wmap" id="wmap"></div>
      <div class="textmain" id="textmain">
        <div class="tmheader" id="tmheader"></div>
        <div class="tmtext" id="tmtext"></div>
      </div>
    </div>
    <div class="stock" id="stock"></div>
    <div class="weather" id="weather"></div>
    <div class="inet" id="inet"></div>
    <div class="ticker" id="ticker"></div>
  </div>
</body>
</html>